# 2025.9.27
一轮测试非常顺利，通过压线端子链接电线后，电线远端手的触摸可以获得准确信号的，并且串口通信与输出、存储都很不错。  
但将设备转移到实验室后，继上周通过导线链接到水嘴信号不太成功后，新的问题出现了。  
# TTP224的响应本身出现问题：
### 1.
4路信号中有时候无法完全响应，即发生触摸仍然没有信号  <img width="622" height="696" alt="image" src="https://github.com/user-attachments/assets/f9f502bb-9bca-4810-b1e3-a7edd60514e2" />

### 2. 
反向！即不触摸时有信号，触摸时无信号
### 3.
随着是使用串口链接和ST-link链接问题不一样

相当奇怪  
# 2025.10.8
## 器件排障尝试：
1.查询数据手册TOG引脚悬空时应该是直接模式-也就是触摸产生有效信号，但实际情况并非如此？  
2.通过ST-LINK的供电线直接连到电脑的USB输出部分，后不经过STM32链接到TTP224上，在出现短暂的，闪烁式正常触摸信号后又出现了不应期。  
3.更换TTP224模块后情况类似，因此应该是电压的问题  
4.电压检查，使用电源模块满足TTP2242.4V`5.5V的的要求
## 接线尝试：（此时直接依赖电源模块供电，不经过STM32）
我们注意到数据手册中对TOG/OD/AHLB三个端口通过接线是可以更改的，默认模式下TOD为0；OD为1；AHLB为0；  
因此怀疑其可能是响应模式有误-反向的信号；此外怀疑其处于低功耗模式下的原因  
因此，我怀疑可能是由于某种原因使得其默认链接被修改了，做以下实验尝试：  
### 1.采用链接线直接接原理图中的LPMB与高电平。强制处于快速模式下。！它正常工作了,但当我重新使用STM32供电时，它再次失败了    
### 2.我按照输出模式选择更改了T/D/A（上文提到的）<img width="782" height="250" alt="image" src="https://github.com/user-attachments/assets/6ebc6562-273b-4a3b-8685-81211c487aa6" />

### 3.首先判断TOG状态：因为TOG为触发模式的时候，会在触发持续一段时间后输出信号，直接模式时就是及时响应的。  
### 4.通过连结TOG口与地线，强制使其处于直接模式下。并检查了SM口，确认可以产生两个与两个以上的信号。  
### 5.接下来我们使用CMOS输出，OD接地。并通过AHLB接地使得高电平有效。~仍然出现了初始点亮后触摸关闭的情况？  
# 2025.10.9
## 一些观察
使用type-C线向STM32供电时，类似的情况较少，而使用串口和STlink供电时偶发。但TTP224的工作电流才9uA ，应该说远小于这三种中任意种类的电流上限.
# 2025.10.13
经过排查，原因已经出现了：因为PA1,PA2,PA3,PA4的input口上带电，大概在1.2V左右。这个电压导致了不正常的信号。但问题是在STM32CUBEMX上我设置了input+下拉电阻的模式，理论上来说，我们应该会获得0V的电压。  
事实上，整个STM32最小系统板上的引脚都带电。
# 2025.10.13
一个关键问题出现了。当我使用接电源的电脑USB口供电时，整个系统会不正常工作，而当断开电脑电源线使用电脑的电池向USB口供电时，系统正常了。  
随后我做了几个对比的小实验：  
## 1.将各个信号输入口接地处理，使得其电势为0——信号仍不正常  
## 2.使用万用表测量Arduino的地线和电脑USB输出的地线间的电压差：
  ### a.在使用220V电源向电脑供电时：电脑的USB地线与Arduino地线存在一个-0.69到0.69V左右的周期性电势差  
  ### b.在使用电脑电池供电时，其USB地线与Arduino地线之间有一个0.3V左右的稳定电势差
  ### c.（此时TTP224由Arduino输出供电）当我将这两个供电方共地时，信号不正常
  ### d.怀疑USB输出有交流成分——但用万用表交流挡位测量，显示为0（但仍然不能排除其存在高频噪声，可能高于万用表能测量的范围）
  ### e.怀疑两种电源的输入不对：万用表直流测量均为3.3V
## 总结：只有在由电脑的电池供电时，信号才能稳定传输。其他情况都存在或多或少的问题。
## 分析：一个可能的原因是地环路干扰。
